<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test My Trips Modal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .day-plan {
            background: #f8f9fa;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .activity {
            background: white;
            margin: 8px 0;
            padding: 10px;
            border-radius: 3px;
            border: 1px solid #e9ecef;
        }
        .activity-time {
            color: #6c757d;
            font-size: 0.9em;
        }
        .activity-cost {
            color: #28a745;
            font-weight: bold;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">My Trips Modal Data Structure Test</h1>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <button class="test-button" onclick="testApiConnection()">Test API Connection</button>
            <button class="test-button" onclick="testDataStructure()">Test Data Structure</button>
            <button class="test-button" onclick="simulateModalRender()">Simulate Modal Render</button>
        </div>

        <div class="test-section">
            <h2>Expected Data Structure</h2>
            <pre id="expected-structure">{
  "id": 1,
  "title": "Cultural Discovery: 4 Days in Oran",
  "daily_plans": [
    {
      "id": 1,
      "date": "2025-09-24",
      "title": "Day 1: Arrival & City Tour",
      "description": "...",
      "activities": [
        {
          "id": 1,
          "start_time": "09:00:00",
          "end_time": "11:30:00",
          "estimated_cost": "41.90",
          "place": {
            "name": "Hotel Sheraton Oran",
            "address": "..."
          }
        }
      ]
    }
  ]
}</pre>
        </div>

        <div class="test-section">
            <h2>Test Results</h2>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>Modal Simulation</h2>
            <div id="modal-simulation"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        async function testApiConnection() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>Testing API connection...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/trip-planner/trip-plans/`);
                
                if (response.status === 401) {
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            <h3>Authentication Required</h3>
                            <p>API requires authentication. Status: ${response.status}</p>
                            <p>This is expected behavior - the API is working correctly.</p>
                        </div>
                    `;
                } else if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            <h3>API Connection Successful</h3>
                            <p>Status: ${response.status}</p>
                            <p>Data received: ${JSON.stringify(data).substring(0, 200)}...</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="result error">
                            <h3>API Error</h3>
                            <p>Status: ${response.status}</p>
                            <p>Response: ${await response.text()}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>Connection Error</h3>
                        <p>Error: ${error.message}</p>
                        <p>Make sure the backend server is running on port 8000.</p>
                    </div>
                `;
            }
        }
        
        function testDataStructure() {
            const resultsDiv = document.getElementById('test-results');
            
            // Simulate the data structure we expect from the API
            const mockTripData = {
                id: 1,
                title: "Cultural Discovery: 4 Days in Oran",
                daily_plans: [
                    {
                        id: 1,
                        date: "2025-09-24",
                        title: "Day 1: Arrival & City Tour",
                        description: "Start your cultural journey",
                        activities: [
                            {
                                id: 1,
                                start_time: "09:00:00",
                                end_time: "11:30:00",
                                estimated_cost: "41.90",
                                place: {
                                    name: "Hotel Sheraton Oran",
                                    address: "Oran, Algeria"
                                }
                            },
                            {
                                id: 2,
                                start_time: "13:00:00",
                                end_time: "15:30:00",
                                estimated_cost: "9.44",
                                place: {
                                    name: "Great Mosque of Oran",
                                    address: "Oran, Algeria"
                                }
                            }
                        ]
                    }
                ]
            };
            
            // Test if the structure matches our expectations
            const tests = [
                { name: 'Has title', test: () => mockTripData.title !== undefined },
                { name: 'Has daily_plans array', test: () => Array.isArray(mockTripData.daily_plans) },
                { name: 'Daily plans have activities', test: () => mockTripData.daily_plans[0].activities !== undefined },
                { name: 'Activities have place info', test: () => mockTripData.daily_plans[0].activities[0].place !== undefined },
                { name: 'Activities have time info', test: () => mockTripData.daily_plans[0].activities[0].start_time !== undefined }
            ];
            
            let results = '<div class="result success"><h3>Data Structure Tests</h3>';
            let allPassed = true;
            
            tests.forEach(test => {
                const passed = test.test();
                allPassed = allPassed && passed;
                results += `<p>✓ ${test.name}: ${passed ? 'PASS' : 'FAIL'}</p>`;
            });
            
            results += `<p><strong>Overall: ${allPassed ? 'ALL TESTS PASSED' : 'SOME TESTS FAILED'}</strong></p></div>`;
            resultsDiv.innerHTML = results;
        }
        
        function simulateModalRender() {
            const modalDiv = document.getElementById('modal-simulation');
            
            // Simulate the trip data structure
            const tripData = {
                title: "Cultural Discovery: 4 Days in Oran",
                destination: "Oran, Algeria",
                duration: 4,
                daily_plans: [
                    {
                        date: "2025-09-24",
                        title: "Day 1: Arrival & City Tour",
                        description: "Start your cultural journey in Oran",
                        activities: [
                            {
                                start_time: "09:00:00",
                                end_time: "11:30:00",
                                estimated_cost: "41.90",
                                place: { name: "Hotel Sheraton Oran", address: "Oran Center" }
                            },
                            {
                                start_time: "13:00:00",
                                end_time: "15:30:00",
                                estimated_cost: "9.44",
                                place: { name: "Great Mosque of Oran", address: "Old City" }
                            }
                        ]
                    },
                    {
                        date: "2025-09-25",
                        title: "Day 2: Historical Sites",
                        description: "Explore the rich history of Oran",
                        activities: [
                            {
                                start_time: "09:00:00",
                                end_time: "11:30:00",
                                estimated_cost: "38.32",
                                place: { name: "Santa Cruz Fort", address: "Oran Heights" }
                            }
                        ]
                    }
                ]
            };
            
            // Render the modal content similar to React component
            let modalContent = `
                <h3>${tripData.title}</h3>
                <p><strong>Destination:</strong> ${tripData.destination}</p>
                <p><strong>Duration:</strong> ${tripData.duration} days</p>
                <h4>Daily Itinerary:</h4>
            `;
            
            tripData.daily_plans.forEach((day, dayIndex) => {
                modalContent += `
                    <div class="day-plan">
                        <h5>${day.title} (${day.date})</h5>
                        <p>${day.description}</p>
                        <div class="activities">
                `;
                
                day.activities.forEach((activity, actIndex) => {
                    modalContent += `
                        <div class="activity">
                            <strong>${activity.place.name}</strong>
                            <div class="activity-time">
                                ${activity.start_time ? `${activity.start_time} - ${activity.end_time}` : 'Time TBD'}
                            </div>
                            <div>📍 ${activity.place.address}</div>
                            <div class="activity-cost">$${activity.estimated_cost}</div>
                        </div>
                    `;
                });
                
                modalContent += '</div></div>';
            });
            
            modalDiv.innerHTML = modalContent;
        }
        
        // Auto-run tests on page load
        window.onload = function() {
            testDataStructure();
        };
    </script>
</body>
</html>